C251 COMPILER V5.60.0,  uart1                                                              04/03/24  11:37:30  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE uart1
OBJECT MODULE PLACED IN .\Objects\uart1.obj
COMPILER INVOKED BY: D:\Keil_v5\C251\BIN\C251.EXE HARDWARE\src\uart1.c XSMALL BROWSE INCDIR(.\HARDWARE\inc) DEBUG PRINT(
                    -.\Listings\uart1.lst) TABS(2) OBJECT(.\Objects\uart1.obj) 

stmt  level    source

    1          #include "uart1.h" 
    2          #include "delay.h" 
    3          #include "timer.h" 
    4          /*--------------------------------------------------------------*/
    5          /* --- -----------------实验内容 -------------------------------*/
    6          /* --- 1-了解STC-ISP工具生产延时函数方法 -----------------------*/
    7          /* --- 2-掌握子函数的创建与调用---------------------------------*/
    8          /* --- 实验平台：未来电子STC32核心板----------------------------*/
    9          /* --- 视频学习：https://space.bilibili.com/494969171 ----------*/
   10          /* --- QQ交流群：702805632 -------------------------------------*/
   11          /* --- 参考资料：STC32实验室参考例程 ---------------------------*/
   12          /*--------------------------------------------------------------*/
   13          
   14          bit B_TX1_Busy; //发送忙标志
   15          //==========================================================================
   16          
   17          #define Baudrate1   (65536 - 24000000UL / 115200 / 4)
   18          /***************************************************************************
   19           * 描  述 : 串口1初始化函数
   20           * 入  参 : 无
   21           * 返回值 : 无
   22          备注：波特率9600bps   晶振24MHz
   23           **************************************************************************/
   24          void Uart1_Init(void)
   25          {  
   26   1        P3M1 &= 0xFC; P3M0 &= 0xFC;                   //设置P3.0 ,P3.1为准双向口   
   27   1        TR1 = 0;
   28   1        S1BRT = 0;    //S1 BRT Use Timer1;
   29   1        T1_CT = 0;    //Timer1 set As Timer
   30   1        T1x12 = 1;    //Timer1 set as 1T mode
   31   1        TMOD &= ~0x30;//Timer1_16bitAutoReload;
   32   1        TH1 = (u8)(Baudrate1 / 256);
   33   1        TL1 = (u8)(Baudrate1 % 256);
   34   1        ET1 = 0;    //禁止定时器中断
   35   1        TR1 = 1;
   36   1        
   37   1        SCON = (SCON & 0x3f) | 0x40;    //UART1模式, 0x00: 同步移位输出, 0x40: 8位数据,可变波特率, 0x80: 9位数据
             -,固定波特率, 0xc0: 9位数据,可变波特率
   38   1        ES  = 1;    //允许串口中断
   39   1        REN = 1;    //允许接收
   40   1        P_SW1 &= 0x3f;
   41   1        B_TX1_Busy = 0;
   42   1        
   43   1      }
   44          
   45          /***************************************************************************
   46           * 描  述 : 串口1发送数据函数
   47           * 入  参 : uint8 数据
   48           * 返回值 : 无
   49           **************************************************************************/
   50          void SendDataByUart1(unsigned char dat)
   51          {
   52   1          SBUF = dat;                 //写数据到UART数据寄存器
   53   1          B_TX1_Busy = 1;
   54   1          while(B_TX1_Busy);                   //清除TI位（该位必须软件清零）
   55   1      } 
   56          /***************************************************************************
   57           * 描  述 : 串口1中断服务函数
C251 COMPILER V5.60.0,  uart1                                                              04/03/24  11:37:30  PAGE 2   

   58           * 入  参 : 无
   59           * 返回值 : 无
   60           **************************************************************************/
   61          void Uart1() interrupt 4 using 1
   62          {
   63   1          ES = 0;                     // 串口1中断关闭
   64   1          if (RI)                     //串行接收到停止位的中间时刻时，该位置1
   65   1         {
   66   2            RI = 0;                 //清除RI位 （该位必须软件清零）SBUF; 
   67   2            
   68   2         }
   69   1         if (TI)                    //在停止位开始发送时，该位置1
   70   1         {
   71   2            TI = 0;                 //清除TI位（该位必须软件清零） 
   72   2            B_TX1_Busy = 0;
   73   2         }
   74   1         ES =  1;                   // 串口1中断打开
   75   1      }
   76          //========================================================================
   77          // 函数: void PrintString1(u8 *puts)
   78          // 描述: 串口1发送字符串函数。
   79          // 参数: puts:  字符串指针.
   80          // 返回: none.
   81          // 版本: VER1.0
   82          // 日期: 2022-09-24
   83          // 备注: 
   84          //========================================================================
   85          //void PrintString1(unsigned char *puts)
   86          //{
   87          //    for (; *puts != 0;  puts++)     //遇到停止符0结束
   88          //    {
   89          //        SBUF = *puts;
   90          //        B_TX1_Busy = 1;
   91          //        while(B_TX1_Busy);
   92          //    }
   93          //}
   94          //========================================================================
   95          // 函数: void program_automatic_update(void)
   96          // 描述: 程序自动下载。
   97          // 参数: 程序自动下载。.
   98          // 返回: none.
   99          // 版本: VER1.0
  100          // 日期: 2022-09-24
  101          // 备注: 
  102          //======================================================================== 
  103          
  104          //void program_automatic_update(void)
  105          //{
  106          //    static unsigned char recv_cnt = 0;
  107          //    if (SBUF == 0xAF)
  108          //    {
  109          //        if (++recv_cnt >= 5)
  110          //        {
  111          //            recv_cnt = 0;
  112          //            IAP_CONTR = 0x60;   //触发软件复位，从ISP开始执行
  113          //        }
  114          //    }
  115          //    else
  116          //    {
  117          //        recv_cnt = 0;
  118          //    }
  119          //}
  120          
  121          
  122          
  123          
C251 COMPILER V5.60.0,  uart1                                                              04/03/24  11:37:30  PAGE 3   

  124          
  125          
  126          
  127          
  128          
  129          
  130          
  131          
  132          


Module Information          Static   Overlayable
------------------------------------------------
  code size            =        77     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =         1     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
